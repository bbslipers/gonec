Функция бенч2()
	дтнач = ТекущаяДата()

	ОбработатьHTTP = Функция (вых,вх)
		Сообщить("Сервер получил запрос:\n",вх.Сообщение())
		вых.Отправить({"Статус":200, "Тело":"Запрос обработан успешно"})
	КонецФункции

	серв = Новый Сервер
	Попытка
		серв.Открыть("http", "127.0.0.1:9990", 1000, {"/test":ОбработатьHTTP}, 0)
	Исключение
		Сообщить(ОписаниеОшибки())
		Сообщить("Кажется сервер уже запущен, или тут какая-то другая ошибка, но мы все равно попробуем отправить запрос :)")
	КонецПопытки

	Для н=1 по 1000 Цикл
		кли = Новый Клиент
		соед = кли.Соединить("http","")
        Сообщить("Устанавливаем соединение:",соед)
        запр={
			"Метод": "GET",
			"Путь": "http://127.0.0.1:9990/test",
			"Заголовки": {
				"ReqId":соед.Идентификатор(),
				},
			"Параметры": {
					"id":соед.Идентификатор(),
					"query":"Запрос по http протоколу",
					"num": н,
			    },
			}
		Сообщить("Отправляем:", запр)
		Попытка
		    Сообщить("Ответ",н,":",соед.Запрос(запр))
		Исключение
		    Сообщить(ОписаниеОшибки())
		КонецПопытки
		кли.Закрыть()
	КонецЦикла
	
	серв.Закрыть()

	Возврат ПрошлоВремениС(дтнач)
КонецФункции

Сообщить("Все завершилось просто идеально: HTTP за", бенч2(), "!")

