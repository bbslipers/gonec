дтнач = ТекущаяДата()
		
Функция ОбработатьСерв(соед)
	Сообщить("Сервер получил соединение:",соед)
	Сообщить("Получен запрос:",соед.Получить())
КонецФункции

серв = Новый Сервер
Попытка
	серв.Открыть("tcp", "127.0.0.1:9990", 1000, ОбработатьСерв, 0)
Исключение
	Сообщить(ОписаниеОшибки())
	Сообщить("Кажется сервер уже запущен, или тут какая-то другая ошибка, но мы все равно попробуем отправить запрос :)")
КонецПопытки

клиенты = []
гр = Новый ГруппаОжидания

фобр = Функция (соед)
		д = соед.Данные()
		Сообщить("Устанавливаем соединение:",соед)
		запр={
			"id":соед.Идентификатор(),
			"query":"Запрос по tcp протоколу",
			"num":д[1],
			}
		Сообщить("Отправляем:", запр)
		соед.Отправить(запр)
		д[0].Завершить()
	КонецФункции

Для н=1 по 1000 Цикл
	кли = Новый Клиент
	гр.Добавить(1)
	кли.Открыть("tcp", "127.0.0.1:9990", фобр, [гр, н])
	клиенты += кли
КонецЦикла

гр.Ожидать()
серв.Закрыть()

Сообщить("Все завершилось просто идеально за", ПрошлоВремениС(дтнач), "!")
	    